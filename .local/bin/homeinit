#!/bin/sh
## homeinit

GREEN='\033[0;32m\033[1m'
NORMAL='\033[0m\033[1m'


echo -e "${GREEN}== homeinit  =="
echo -e "${NORMAL}Initialization of home folder"

echo -e "${GREEN}==> System packages"
echo -e "${NORMAL} :: Installing all official packages"
pacman_list=""
if [ -f ~/.pkglists/arch-official ]; then
    pacman_list="$(cat ~/.pkglists/arch-official)"
fi
sudo pacman --noconfirm -S --needed base base-devel $pacman_list

echo -e "${NORMAL} :: Removing orphans"
pacman_list=$(pacman -Qdtq)
if [ -n "$pacman_list" ]; then
    sudo pacman --noconfirm -Rs "$pacman_list"
fi

echo -e "${GREEN}==> Create 'temp' folder"
mkdir -pv "$HOME/temp"

echo -e "${GREEN}==> Create 'projects' folder"
mkdir -pv "$HOME/projects"

echo -e "${GREEN}==> Install emacs packages"
yes | emacs --batch -l ~/.emacs.d/first-installation.el

echo -e "${GREEN}==> Go"
echo -e "${NORMAL} :: Creating go folder"
mkdir -pv "$HOME/projects/go"
echo -e "${NORMAL} :: Go path"
export GOPATH="$HOME/projects/go"
export PATH="$PATH:$GOPATH/bin"
echo -e "${NORMAL} :: Install go tools"
go get github.com/nsf/gocode
go get github.com/rogpeppe/godef
go get github.com/eugeii/goimports

echo -e "${GREEN}==> Emails"
echo -e "${NORMAL} :: Creating folders"
mkdir -pv "$HOME/.cache/mail/perso"
mkdir -pv "$HOME/.cache/mail/tuedachu"

echo -e -n "${NORMAL}Do you want to synchronize all emails? (y/N) "
read sync
sync=$(echo "$sync" | awk '{print tolower($0)}')
if [ "$sync" = "y" ]
then
    echo -e "${NORMAL} :: Synchronizing emails"
    mbsync -a
    mu index -m "$HOME/.cache/mail"
fi
